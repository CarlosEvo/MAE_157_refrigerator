%% AXV_2

results_AXV_2 = struct();

% 15 psig data point index
idx_8 = 2;

% #1: T1 gives enthalpy and entropy (saturated liquid)
results_AXV_2.H_1 = interp1(R12_sat.T, R12_sat.H_f, data.T1(idx_8));
% results_AXV_2.S_1 = interp1(R12_sat.T, R12_sat.S_f, data.T1(idx_8));

% #2: same enthalpy, T2 gives quality x
results_AXV_2.H_2 = results_AXV_2.H_1;
% H_2_f = interp1(R12_sat.T, R12_sat.H_f, data.T2(idx_8));
% H_2_g = interp1(R12_sat.T, R12_sat.H_g, data.T2(idx_8));
% S_2_f = interp1(R12_sat.T, R12_sat.S_f, data.T2(idx_8));
% S_2_g = interp1(R12_sat.T, R12_sat.S_g, data.T2(idx_8));
% results_AXV_2.x_2 = quality(H_2_f, H_2_g, results_AXV_2.H_2);
% results_AXV_2.S_2 = mix(S_2_f, S_2_g, results_AXV_2.x_2);

% #3_g: isobaric, isothermal
% results_AXV_2.H_3_g = H_2_g;
% results_AXV_2.S_3_g = S_2_g;

% #3: pressure table
[T, P] = meshgrid(R12_P_4.T, [140, 150] .* 1000);
results_AXV_2.H_3 = interp2(...
    T, P, [R12_P_4.H_140, R12_P_4.H_150].',...
    data.T3(idx_8), data.P3(idx_8)...
);
results_AXV_2.S_3 = interp2(...
    T, P, [R12_P_4.S_140, R12_P_4.S_150].',...
    data.T3(idx_8), data.P3(idx_8)...
);

% #4
% Experimental Value
[T, P] = meshgrid(R12_P_15.T, [850, 900] .* 1000);

% Ideal value
results_AXV_2.S_4_ideal = results_AXV_2.S_3;
results_AXV_2.T_4_ideal = fzero(...
    @(T_4_ideal) interp2(...
        T, P,...
        [R12_P_15.S_850, R12_P_15.S_900].',...
        T_4_ideal, data.P4(idx_8)...
    ) - results_AXV_2.S_4_ideal,...
    data.T5(idx_8) + 50 ...
);
results_AXV_2.H_4_ideal = interp2(...
    T, P,...
    [R12_P_15.H_850, R12_P_15.H_900].',...
    results_AXV_2.T_4_ideal, data.P4(idx_8)...
);

% Coefficient of performance
results_AXV_2.COP_real = COP_real(data.mass(idx_8), results_AXV_2.H_2, results_AXV_2.H_3);
results_AXV_2.COP_ideal = COP_ideal(...
    results_AXV_2.H_2, results_AXV_2.H_3, results_AXV_2.H_4_ideal...
);

% Refrigeration capacity
results_AXV_2.RC = capacity(...
    data.mass(idx_8), results_AXV_2.H_2, results_AXV_2.H_3...
);

results_AXV_2 = struct2table(results_AXV_2);
